const fs = require("fs");
const bs58 = require("bs58");
const {
  Connection,
  Keypair,
  PublicKey,
  clusterApiUrl,
  Transaction,
  sendAndConfirmTransaction,
} = require("@solana/web3.js");
const {
  createUpdateMetadataAccountV2Instruction,
} = require("@metaplex-foundation/mpl-token-metadata");

const TOKEN_METADATA_PROGRAM_ID = new PublicKey(
  "metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"
);

// === EDIT THESE ===
const MINT_ADDRESS = new PublicKey("G5n4ygNiv5cCt5eCmtXGaFZ2sur6y1weMuMgky37UFS3");
const METADATA_URI = "https://raw.githubusercontent.com/yourgocya-eng/my-sol-token/main/TRUMP.json";
// ==================

(async () => {
  const secretBase58 = fs.readFileSync("./Secret.txt", "utf8").trim();
  const secretKey = bs58.decode(secretBase58);
  const payer = Keypair.fromSecretKey(secretKey);

  const connection = new Connection(clusterApiUrl("mainnet-beta"), "confirmed");

  const [metadataPda] = await PublicKey.findProgramAddress(
    [Buffer.from("metadata"), TOKEN_METADATA_PROGRAM_ID.toBuffer(), MINT_ADDRESS.toBuffer()],
    TOKEN_METADATA_PROGRAM_ID
  );

  const tx = new Transaction().add(
    createUpdateMetadataAccountV2Instruction(
      {
        metadata: metadataPda,
        updateAuthority: payer.publicKey,
      },
      {
        updateMetadataAccountArgsV2: {
          data: {
            name: "Make Africa Great Again",
            symbol: "MAGA",
            uri: METADATA_URI,
            sellerFeeBasisPoints: 0,
            creators: null,
            collection: null,
            uses: null,
          },
          updateAuthority: payer.publicKey,
          primarySaleHappened: null,
          isMutable: true,
        },
      }
    )
  );

  const sig = await sendAndConfirmTransaction(connection, tx, [payer]);
  console.log("âœ… Metadata updated!");
  console.log("Signature:", sig);
})();
